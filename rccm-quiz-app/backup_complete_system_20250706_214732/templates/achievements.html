{% extends "base.html" %}

{% block title %}é”æˆãƒãƒƒã‚¸ãƒ»å­¦ç¿’è¨˜éŒ² - RCCMè©¦é¨“å•é¡Œé›†{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-trophy text-warning"></i> é”æˆãƒãƒƒã‚¸ãƒ»å­¦ç¿’è¨˜éŒ²</h2>
                <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                    <i class="fas fa-home"></i> ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
                </a>
            </div>
        </div>
    </div>

    <!-- å­¦ç¿’ã‚µãƒãƒªãƒ¼ -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <div class="display-4">ğŸ”¥</div>
                    <h5>ç¾åœ¨ã®ã‚¹ãƒˆãƒªãƒ¼ã‚¯</h5>
                    <h3>{{ insights.study_streak or 0 }}æ—¥</h3>
                    <small>æœ€å¤§: {{ insights.max_streak or 0 }}æ—¥</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <div class="display-4">ğŸ¯</div>
                    <h5>ç·å›ç­”æ•°</h5>
                    <h3>{{ insights.total_questions or 0 }}å•</h3>
                    <small>æ­£ç­”ç‡: {{ "%.1f"|format((insights.overall_accuracy or 0) * 100) }}%</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <div class="display-4">ğŸ†</div>
                    <h5>ç²å¾—ãƒãƒƒã‚¸</h5>
                    <h3>{{ insights.badges_earned or 0 }}å€‹</h3>
                    <small>å…¨{{ all_badges|length }}å€‹ä¸­</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-warning text-white">
                <div class="card-body text-center">
                    <div class="display-4">â±ï¸</div>
                    <h5>ç·å­¦ç¿’æ™‚é–“</h5>
                    <h3>{{ "%.1f"|format((insights.total_study_time or 0) / 60) }}åˆ†</h3>
                    <small>å¹³å‡: {{ "%.1f"|format(insights.avg_time_per_question or 0) }}ç§’/å•</small>
                </div>
            </div>
        </div>
    </div>

    <!-- ç²å¾—ãƒãƒƒã‚¸ä¸€è¦§ -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-medal"></i> ç²å¾—ãƒãƒƒã‚¸</h4>
                </div>
                <div class="card-body">
                    {% if earned_badges %}
                        <div class="row">
                            {% for badge in earned_badges %}
                            <div class="col-lg-4 col-md-6 mb-3">
                                <div class="card border-{{ badge.color }}">
                                    <div class="card-body text-center">
                                        <div class="display-4 mb-2">{{ badge.icon }}</div>
                                        <h5 class="card-title text-{{ badge.color }}">{{ badge.name }}</h5>
                                        <p class="card-text">{{ badge.description }}</p>
                                        <span class="badge badge-{{ badge.color }}">ç²å¾—æ¸ˆã¿</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <div class="display-1 text-muted">ğŸ¯</div>
                            <h4>ã¾ã ãƒãƒƒã‚¸ã‚’ç²å¾—ã—ã¦ã„ã¾ã›ã‚“</h4>
                            <p class="text-muted">å•é¡Œã«æŒ‘æˆ¦ã—ã¦ãƒãƒƒã‚¸ã‚’é›†ã‚ã¾ã—ã‚‡ã†ï¼</p>
                            <a href="{{ url_for('quiz') }}" class="btn btn-primary">
                                <i class="fas fa-play"></i> å•é¡Œã‚’å§‹ã‚ã‚‹
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- æœªç²å¾—ãƒãƒƒã‚¸ä¸€è¦§ -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-target"></i> æœªç²å¾—ãƒãƒƒã‚¸ï¼ˆç›®æ¨™ï¼‰</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for badge_id, badge_info in all_badges.items() %}
                            {% if badge_id not in (earned_badges | map(attribute='id') | list) %}
                            <div class="col-lg-4 col-md-6 mb-3">
                                <div class="card border-light bg-light">
                                    <div class="card-body text-center opacity-75">
                                        <div class="display-4 mb-2 text-muted">{{ badge_info.icon }}</div>
                                        <h5 class="card-title text-muted">{{ badge_info.name }}</h5>
                                        <p class="card-text text-muted">{{ badge_info.description }}</p>
                                        <span class="badge badge-secondary">æœªç²å¾—</span>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å­¦ç¿’ã‚¤ãƒ³ã‚µã‚¤ãƒˆ -->
    <div class="row mt-4">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-chart-line"></i> å­¦ç¿’å‚¾å‘</h5>
                </div>
                <div class="card-body">
                    <p><strong>æœ€é©ãªå­¦ç¿’æ™‚é–“:</strong> {{ insights.peak_study_hour or 12 }}æ™‚é ƒ</p>
                    <p><strong>æœ€è¿‘ã®èª¿å­:</strong> 
                        {% if insights.improvement_trend > 0.1 %}
                            <span class="text-success">ğŸ“ˆ å‘ä¸Šä¸­ï¼</span>
                        {% elif insights.improvement_trend < -0.1 %}
                            <span class="text-warning">ğŸ“‰ è¦æ³¨æ„</span>
                        {% else %}
                            <span class="text-info">â¡ï¸ å®‰å®š</span>
                        {% endif %}
                    </p>
                    
                    {% if insights.strengths %}
                    <div class="mt-3">
                        <strong>å¾—æ„åˆ†é‡:</strong>
                        {% for strength in insights.strengths %}
                            <span class="badge badge-success mr-1">{{ strength }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    {% if insights.weaknesses %}
                    <div class="mt-2">
                        <strong>å¼·åŒ–åˆ†é‡:</strong>
                        {% for weakness in insights.weaknesses %}
                            <span class="badge badge-danger mr-1">{{ weakness }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-lightbulb"></i> å­¦ç¿’ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h5>
                </div>
                <div class="card-body">
                    {% if insights.study_streak == 0 %}
                        <div class="alert alert-info">
                            <strong>ğŸš€ å­¦ç¿’ã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†ï¼</strong><br>
                            ç¶™ç¶šçš„ãªå­¦ç¿’ã§ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’ç¯‰ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚
                        </div>
                    {% elif insights.study_streak < 7 %}
                        <div class="alert alert-warning">
                            <strong>ğŸ”¥ ã‚¹ãƒˆãƒªãƒ¼ã‚¯ç¶™ç¶šä¸­ï¼</strong><br>
                            ã‚ã¨{{ 7 - insights.study_streak }}æ—¥ã§ã€Œ7æ—¥é€£ç¶šå­¦ç¿’ã€ãƒãƒƒã‚¸ã‚’ç²å¾—ã§ãã¾ã™ã€‚
                        </div>
                    {% elif insights.study_streak < 30 %}
                        <div class="alert alert-success">
                            <strong>ğŸ† ç´ æ™´ã‚‰ã—ã„ã‚¹ãƒˆãƒªãƒ¼ã‚¯ï¼</strong><br>
                            ã‚ã¨{{ 30 - insights.study_streak }}æ—¥ã§ã€Œ30æ—¥é€£ç¶šå­¦ç¿’ã€ãƒãƒƒã‚¸ã‚’ç²å¾—ã§ãã¾ã™ã€‚
                        </div>
                    {% else %}
                        <div class="alert alert-primary">
                            <strong>ğŸ‘‘ å­¦ç¿’ãƒã‚¹ã‚¿ãƒ¼ï¼</strong><br>
                            ç´ æ™´ã‚‰ã—ã„ç¶™ç¶šåŠ›ã§ã™ã€‚ã“ã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼
                        </div>
                    {% endif %}
                    
                    {% if insights.recent_accuracy < 0.7 %}
                        <div class="alert alert-warning mt-2">
                            <strong>ğŸ’ª å¾©ç¿’ã®ã™ã™ã‚</strong><br>
                            æœ€è¿‘ã®æ­£ç­”ç‡ãŒä½ä¸‹ã—ã¦ã„ã¾ã™ã€‚å¾©ç¿’æ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã¾ã—ã‚‡ã†ã€‚
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
    <div class="row mt-4 mb-4">
        <div class="col-12 text-center">
            <a href="{{ url_for('quiz') }}" class="btn btn-primary btn-lg mr-2">
                <i class="fas fa-play"></i> å•é¡Œã«æŒ‘æˆ¦
            </a>
            <a href="{{ url_for('study_calendar') }}" class="btn btn-info btn-lg mr-2">
                <i class="fas fa-calendar-alt"></i> å­¦ç¿’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
            </a>
            <a href="{{ url_for('statistics') }}" class="btn btn-secondary btn-lg">
                <i class="fas fa-chart-bar"></i> è©³ç´°çµ±è¨ˆ
            </a>
        </div>
    </div>
</div>

<style>
.card {
    transition: transform 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-5px);
}

.opacity-75 {
    opacity: 0.75;
}

.display-4 {
    font-size: 2.5rem;
}

@media (max-width: 768px) {
    .display-4 {
        font-size: 2rem;
    }
}
</style>
{% endblock %}