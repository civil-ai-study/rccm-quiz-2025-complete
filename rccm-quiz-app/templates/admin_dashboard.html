<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ - RCCMÂ≠¶Áøí„Ç¢„Éó„É™</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-card {
            transition: transform 0.2s;
            height: 100%;
        }
        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0;
        }
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .alert-item {
            border-left: 4px solid;
            border-radius: 0;
        }
        .alert-critical {
            border-left-color: #dc3545;
            background-color: #f8d7da;
        }
        .alert-warning {
            border-left-color: #ffc107;
            background-color: #fff3cd;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        .nav-pills .nav-link.active {
            background-color: #667eea;
        }
        .table-hover tbody tr:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }
        .progress-thin {
            height: 8px;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-danger { background-color: #dc3545; }
        .sidebar {
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            transition: all 0.3s;
        }
        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: white;
            background-color: rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
            <div class="col-md-2 p-0 sidebar">
                <div class="p-3">
                    <h5><i class="fas fa-tachometer-alt me-2"></i>ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h5>
                </div>
                <nav class="nav nav-pills flex-column">
                    <a class="nav-link active" href="#overview" data-bs-toggle="pill">
                        <i class="fas fa-chart-line me-2"></i>Ê¶ÇË¶Å
                    </a>
                    <a class="nav-link" href="#questions" data-bs-toggle="pill">
                        <i class="fas fa-question-circle me-2"></i>ÂïèÈ°åÁÆ°ÁêÜ
                    </a>
                    <a class="nav-link" href="#users" data-bs-toggle="pill">
                        <i class="fas fa-users me-2"></i>„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ
                    </a>
                    <a class="nav-link" href="#content" data-bs-toggle="pill">
                        <i class="fas fa-book me-2"></i>„Ç≥„É≥„ÉÜ„É≥„ÉÑÂàÜÊûê
                    </a>
                    <a class="nav-link" href="#performance" data-bs-toggle="pill">
                        <i class="fas fa-rocket me-2"></i>„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ
                    </a>
                    <a class="nav-link" href="#reports" data-bs-toggle="pill">
                        <i class="fas fa-file-alt me-2"></i>„É¨„Éù„Éº„Éà
                    </a>
                </nav>
                <div class="mt-auto p-3">
                    <a href="/" class="btn btn-outline-light btn-sm">
                        <i class="fas fa-arrow-left me-2"></i>„Ç¢„Éó„É™„Å´Êàª„Çã
                    </a>
                </div>
            </div>

            <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div class="col-md-10">
                <div class="p-4">
                    <div class="tab-content">
                        <!-- Ê¶ÇË¶Å„Çø„Éñ -->
                        <div class="tab-pane fade show active" id="overview">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2><i class="fas fa-chart-line me-2"></i>„Ç∑„Çπ„ÉÜ„É†Ê¶ÇË¶Å</h2>
                                <button class="btn btn-primary" onclick="refreshData()">
                                    <i class="fas fa-sync-alt me-2"></i>Êõ¥Êñ∞
                                </button>
                            </div>

                            <!-- ÈáçË¶ÅÊåáÊ®ô -->
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="card metric-card dashboard-card">
                                        <div class="card-body text-center">
                                            <div class="metric-value" id="total-questions">{{ overview.questions.total_questions | default(0) }}</div>
                                            <div class="metric-label">Á∑èÂïèÈ°åÊï∞</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card metric-card dashboard-card">
                                        <div class="card-body text-center">
                                            <div class="metric-value" id="total-users">{{ overview.users.total_count | default(0) }}</div>
                                            <div class="metric-label">Á∑è„É¶„Éº„Ç∂„ÉºÊï∞</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card metric-card dashboard-card">
                                        <div class="card-body text-center">
                                            <div class="metric-value" id="active-users">{{ overview.users.active_count | default(0) }}</div>
                                            <div class="metric-label">„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„É¶„Éº„Ç∂„Éº</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card metric-card dashboard-card">
                                        <div class="card-body text-center">
                                            <div class="metric-value" id="system-health">{{ "%.1f"|format(overview.performance.response_time * 1000 | default(100)) }}ms</div>
                                            <div class="metric-label">Âπ≥ÂùáÂøúÁ≠îÊôÇÈñì</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- „Ç¢„É©„Éº„Éà„Å®„Ç∞„É©„Éï -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5><i class="fas fa-exclamation-triangle me-2"></i>„Ç∑„Çπ„ÉÜ„É†„Ç¢„É©„Éº„Éà</h5>
                                        </div>
                                        <div class="card-body">
                                            {% if overview.alerts %}
                                                {% for alert in overview.alerts %}
                                                <div class="alert alert-{{ 'critical' if alert.type == 'critical' else 'warning' }} alert-item mb-2">
                                                    <i class="fas fa-{{ 'exclamation-circle' if alert.type == 'critical' else 'exclamation-triangle' }} me-2"></i>
                                                    {{ alert.message }}
                                                </div>
                                                {% endfor %}
                                            {% else %}
                                                <div class="alert alert-success">
                                                    <i class="fas fa-check-circle me-2"></i>
                                                    „Ç∑„Çπ„ÉÜ„É†„ÅØÊ≠£Â∏∏„Å´Âãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„Åô
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5><i class="fas fa-chart-pie me-2"></i>ÈÉ®ÈñÄÂà•ÂïèÈ°åÂàÜÂ∏É</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container">
                                                <canvas id="departmentChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÂïèÈ°åÁÆ°ÁêÜ„Çø„Éñ -->
                        <div class="tab-pane fade" id="questions">
                            <h2><i class="fas fa-question-circle me-2"></i>ÂïèÈ°åÁÆ°ÁêÜ</h2>
                            
                            <div class="row mb-4">
                                <div class="col-md-12">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>ÂïèÈ°åÁµ±Ë®à„Çµ„Éû„É™„Éº</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <strong>Á∑èÂïèÈ°åÊï∞:</strong> <span id="q-total">{{ questions.total_questions | default(0) }}</span>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>ÈÉ®ÈñÄÊï∞:</strong> <span id="q-departments">{{ questions.by_department | length | default(0) }}</span>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>„Ç´„ÉÜ„Ç¥„É™Êï∞:</strong> <span id="q-categories">{{ questions.by_category | length | default(0) }}</span>
                                                </div>
                                                <div class="col-md-3">
                                                    <strong>„Éá„Éº„ÇøÂìÅË≥™„Çπ„Ç≥„Ç¢:</strong> 
                                                    <span class="badge bg-{{ 'success' if questions.question_quality.quality_score > 0.8 else 'warning' if questions.question_quality.quality_score > 0.6 else 'danger' }}">
                                                        {{ "%.1f"|format(questions.question_quality.quality_score * 100 | default(0)) }}%
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>ÈÉ®ÈñÄÂà•ÂÜÖË®≥</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>ÈÉ®ÈñÄ</th>
                                                            <th class="text-end">ÂïèÈ°åÊï∞</th>
                                                            <th>Ââ≤Âêà</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% if questions.by_department %}
                                                            {% for dept, count in questions.by_department.items() %}
                                                            <tr>
                                                                <td>{{ dept }}</td>
                                                                <td class="text-end">{{ count }}</td>
                                                                <td>
                                                                    <div class="progress progress-thin">
                                                                        <div class="progress-bar" style="width: {{ (count / questions.total_questions * 100) if questions.total_questions > 0 else 0 }}%"></div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>„Éá„Éº„ÇøÂìÅË≥™ÂàÜÊûê</h5>
                                        </div>
                                        <div class="card-body">
                                            {% if questions.question_quality.issues %}
                                                <div class="alert alert-warning">
                                                    <strong>ÂìÅË≥™ÂïèÈ°å„Åå{{ questions.question_quality.total_issues }}‰ª∂Ë¶ã„Å§„Åã„Çä„Åæ„Åó„Åü:</strong>
                                                    <ul class="mb-0 mt-2">
                                                        {% for issue in questions.question_quality.issues[:5] %}
                                                        <li>{{ issue }}</li>
                                                        {% endfor %}
                                                        {% if questions.question_quality.issues | length > 5 %}
                                                        <li><em>‰ªñ {{ questions.question_quality.issues | length - 5 }} ‰ª∂...</em></li>
                                                        {% endif %}
                                                    </ul>
                                                </div>
                                            {% else %}
                                                <div class="alert alert-success">
                                                    <i class="fas fa-check-circle me-2"></i>
                                                    „Éá„Éº„ÇøÂìÅË≥™„Å´ÂïèÈ°å„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì
                                                </div>
                                            {% endif %}
                                            
                                            <h6>Êï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØÁµêÊûú:</h6>
                                            <ul class="list-unstyled">
                                                <li><span class="status-indicator status-{{ 'success' if questions.data_integrity.unique_ids == questions.data_integrity.total_questions else 'danger' }}"></span>
                                                    „É¶„Éã„Éº„ÇØID: {{ questions.data_integrity.unique_ids }}/{{ questions.data_integrity.total_questions }}</li>
                                                <li><span class="status-indicator status-{{ 'success' if questions.data_integrity.missing_ids == 0 else 'warning' }}"></span>
                                                    Ê¨†ÊêçID: {{ questions.data_integrity.missing_ids }}‰ª∂</li>
                                                <li><span class="status-indicator status-{{ 'success' if questions.data_integrity.duplicate_ids | length == 0 else 'danger' }}"></span>
                                                    ÈáçË§áID: {{ questions.data_integrity.duplicate_ids | length }}‰ª∂</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- „É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ„Çø„Éñ -->
                        <div class="tab-pane fade" id="users">
                            <h2><i class="fas fa-users me-2"></i>„É¶„Éº„Ç∂„ÉºÁÆ°ÁêÜ</h2>
                            
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="card dashboard-card">
                                        <div class="card-body text-center">
                                            <h3 class="text-primary">{{ users.total_users | default(0) }}</h3>
                                            <p class="text-muted">Á∑è„É¶„Éº„Ç∂„ÉºÊï∞</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card dashboard-card">
                                        <div class="card-body text-center">
                                            <h3 class="text-success">{{ users.active_users_last_7days | default(0) }}</h3>
                                            <p class="text-muted">7Êó•Èñì„Ç¢„ÇØ„ÉÜ„Ç£„Éñ</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card dashboard-card">
                                        <div class="card-body text-center">
                                            <h3 class="text-info">{{ "%.1f"|format(users.average_accuracy * 100 | default(0)) }}%</h3>
                                            <p class="text-muted">Âπ≥ÂùáÊ≠£Á≠îÁéá</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>Â≠¶Áøí„Éë„Çø„Éº„É≥ÂàÜÂ∏É</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="chart-container">
                                                <canvas id="learningPatternsChart"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>ÈÉ®ÈñÄÂà•‰∫∫Ê∞óÂ∫¶</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>ÈÉ®ÈñÄ</th>
                                                            <th class="text-end">Â≠¶ÁøíÂõûÊï∞</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% if users.department_popularity %}
                                                            {% for dept, count in users.department_popularity.items() | sort(attribute=1, reverse=true) %}
                                                            <tr>
                                                                <td>{{ dept }}</td>
                                                                <td class="text-end">{{ count }}</td>
                                                            </tr>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑÂàÜÊûê„Çø„Éñ -->
                        <div class="tab-pane fade" id="content">
                            <h2><i class="fas fa-book me-2"></i>„Ç≥„É≥„ÉÜ„É≥„ÉÑÂàÜÊûê</h2>
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>ÊúÄ„ÇÇÈõ£„Åó„ÅÑÂïèÈ°å TOP 5</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>ÂïèÈ°åID</th>
                                                            <th class="text-end">Ê≠£Á≠îÁéá</th>
                                                            <th class="text-end">ÊåëÊà¶ÂõûÊï∞</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% if content.hardest_questions %}
                                                            {% for item in content.hardest_questions[:5] %}
                                                            <tr>
                                                                <td>{{ item.id }}</td>
                                                                <td class="text-end">
                                                                    <span class="badge bg-danger">{{ "%.1f"|format(item.stats.accuracy * 100) }}%</span>
                                                                </td>
                                                                <td class="text-end">{{ item.stats.attempted }}</td>
                                                            </tr>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>ÊúÄ„ÇÇÊòì„Åó„ÅÑÂïèÈ°å TOP 5</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>ÂïèÈ°åID</th>
                                                            <th class="text-end">Ê≠£Á≠îÁéá</th>
                                                            <th class="text-end">ÊåëÊà¶ÂõûÊï∞</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% if content.easiest_questions %}
                                                            {% for item in content.easiest_questions[:5] %}
                                                            <tr>
                                                                <td>{{ item.id }}</td>
                                                                <td class="text-end">
                                                                    <span class="badge bg-success">{{ "%.1f"|format(item.stats.accuracy * 100) }}%</span>
                                                                </td>
                                                                <td class="text-end">{{ item.stats.attempted }}</td>
                                                            </tr>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {% if content.recommendations %}
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5><i class="fas fa-lightbulb me-2"></i>ÊîπÂñÑÊèêÊ°à</h5>
                                        </div>
                                        <div class="card-body">
                                            {% for recommendation in content.recommendations %}
                                            <div class="alert alert-info">
                                                <i class="fas fa-info-circle me-2"></i>{{ recommendation }}
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>

                        <!-- „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Çø„Éñ -->
                        <div class="tab-pane fade" id="performance">
                            <h2><i class="fas fa-rocket me-2"></i>„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñ</h2>
                            
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="card dashboard-card">
                                        <div class="card-body text-center">
                                            <h4 class="text-success">{{ "%.1f"|format(performance.data_quality_score * 100 | default(0)) }}%</h4>
                                            <p class="text-muted">„Éá„Éº„ÇøÂìÅË≥™„Çπ„Ç≥„Ç¢</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card dashboard-card">
                                        <div class="card-body text-center">
                                            <h4 class="text-info">{{ "%.1f"|format(performance.user_engagement_score * 100 | default(0)) }}%</h4>
                                            <p class="text-muted">„É¶„Éº„Ç∂„Éº„Ç®„É≥„Ç≤„Éº„Ç∏„É°„É≥„Éà</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card dashboard-card">
                                        <div class="card-body text-center">
                                            <h4 class="text-warning">{{ "%.1f"|format(performance.learning_effectiveness.average_improvement * 100 | default(0)) }}%</h4>
                                            <p class="text-muted">Â≠¶ÁøíÊîπÂñÑÂ∫¶</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card dashboard-card">
                                        <div class="card-body text-center">
                                            <h4 class="text-primary">{{ "%.1f"|format(performance.learning_effectiveness.knowledge_retention * 100 | default(0)) }}%</h4>
                                            <p class="text-muted">Áü•Ë≠òÂÆöÁùÄÁéá</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>ÊäÄË°ìÊåáÊ®ô</h5>
                                        </div>
                                        <div class="card-body">
                                            <ul class="list-unstyled">
                                                <li><strong>„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÊôÇÈñì:</strong> {{ "%.3f"|format(performance.technical_metrics.data_load_time | default(0)) }}Áßí</li>
                                                <li><strong>Êé®ÂÆö„É°„É¢„É™‰ΩøÁî®Èáè:</strong> {{ performance.technical_metrics.memory_usage.total_estimated | default("‰∏çÊòé") }}</li>
                                                <li><strong>ÂïèÈ°å„Éá„Éº„Çø„Çµ„Ç§„Ç∫:</strong> {{ performance.technical_metrics.memory_usage.questions_data | default("‰∏çÊòé") }}</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>„Éï„Ç°„Ç§„É´</th>
                                                            <th class="text-end">„Çµ„Ç§„Ç∫</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% if performance.technical_metrics.file_sizes %}
                                                            {% for filename, size in performance.technical_metrics.file_sizes.items() %}
                                                            <tr>
                                                                <td>{{ filename }}</td>
                                                                <td class="text-end">{{ size }}</td>
                                                            </tr>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- „É¨„Éù„Éº„Éà„Çø„Éñ -->
                        <div class="tab-pane fade" id="reports">
                            <h2><i class="fas fa-file-alt me-2"></i>„É¨„Éù„Éº„ÉàÁîüÊàê</h2>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>„ÇØ„Ç§„ÉÉ„ÇØ„É¨„Éù„Éº„Éà</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-primary" onclick="generateReport('comprehensive')">
                                                    <i class="fas fa-file-pdf me-2"></i>Á∑èÂêà„É¨„Éù„Éº„Éà
                                                </button>
                                                <button class="btn btn-outline-primary" onclick="generateReport('users')">
                                                    <i class="fas fa-users me-2"></i>„É¶„Éº„Ç∂„Éº„É¨„Éù„Éº„Éà
                                                </button>
                                                <button class="btn btn-outline-primary" onclick="generateReport('content')">
                                                    <i class="fas fa-book me-2"></i>„Ç≥„É≥„ÉÜ„É≥„ÉÑ„É¨„Éù„Éº„Éà
                                                </button>
                                                <button class="btn btn-outline-primary" onclick="generateReport('performance')">
                                                    <i class="fas fa-chart-line me-2"></i>„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„É¨„Éù„Éº„Éà
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card dashboard-card">
                                        <div class="card-header">
                                            <h5>ÁîüÊàê„Åï„Çå„Åü„É¨„Éù„Éº„Éà</h5>
                                        </div>
                                        <div class="card-body" id="report-list">
                                            <p class="text-muted">„É¨„Éù„Éº„Éà„ÇíÁîüÊàê„Åô„Çã„Å®„ÄÅ„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // „Éá„Éº„ÇøÊõ¥Êñ∞
        function refreshData() {
            location.reload();
        }

        // „É¨„Éù„Éº„ÉàÁîüÊàê
        function generateReport(type) {
            const reportList = document.getElementById('report-list');
            const timestamp = new Date().toLocaleString('ja-JP');
            
            fetch(`/admin/api/reports/${type}`, {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                // üõ°Ô∏è ULTRA SYNC XSSÈò≤Ê≠¢: innerHTMLÂ§âÊï∞ÊåøÂÖ•„ÇíÂÆâÂÖ®Âåñ
                const reportItem = document.createElement('div');
                reportItem.className = 'alert alert-success';
                
                const icon = document.createElement('i');
                icon.className = 'fas fa-check-circle me-2';
                
                const strong = document.createElement('strong');
                strong.textContent = type + '„É¨„Éù„Éº„Éà'; // XSSÂÆâÂÖ®Âåñ
                
                const timestamp_span = document.createElement('span');
                timestamp_span.textContent = ' - ' + timestamp; // XSSÂÆâÂÖ®Âåñ
                
                const button = document.createElement('button');
                button.className = 'btn btn-sm btn-outline-success float-end';
                button.onclick = () => downloadReport(type); // XSSÂÆâÂÖ®Âåñ
                button.innerHTML = '<i class="fas fa-download"></i> „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ';
                
                reportItem.appendChild(icon);
                reportItem.appendChild(strong);
                reportItem.appendChild(timestamp_span);
                reportItem.appendChild(button);
                
                if (reportList.querySelector('.text-muted')) {
                    reportList.innerHTML = '';
                }
                reportList.appendChild(reportItem);
            })
            .catch(error => {
                // Report generation error (production mode)
                alert('„É¨„Éù„Éº„ÉàÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            });
        }

        // „É¨„Éù„Éº„Éà„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        function downloadReport(type) {
            const data = JSON.stringify({{ data | tojson if data else '{}' }}, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rccm_${type}_report_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // „ÉÅ„É£„Éº„ÉàÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÈÉ®ÈñÄÂà•ÂàÜÂ∏É„ÉÅ„É£„Éº„Éà
            {% if overview.questions.department_distribution %}
            const departmentCtx = document.getElementById('departmentChart').getContext('2d');
            new Chart(departmentCtx, {
                type: 'doughnut',
                data: {
                    labels: {{ overview.questions.department_distribution.keys() | list | tojson }},
                    datasets: [{
                        data: {{ overview.questions.department_distribution.values() | list | tojson }},
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                            '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            {% endif %}

            // Â≠¶Áøí„Éë„Çø„Éº„É≥„ÉÅ„É£„Éº„Éà
            {% if users.learning_patterns %}
            const learningPatternsCtx = document.getElementById('learningPatternsChart').getContext('2d');
            new Chart(learningPatternsCtx, {
                type: 'bar',
                data: {
                    labels: {{ users.learning_patterns.keys() | list | tojson }},
                    datasets: [{
                        label: '„É¶„Éº„Ç∂„ÉºÊï∞',
                        data: {{ users.learning_patterns.values() | list | tojson }},
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            {% endif %}
        });
    </script>
</body>
</html>